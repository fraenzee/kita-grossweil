---
import { navItems } from '../scripts/navigation.js';
---

<header id="main-header" class="navbar sticky top-0 z-50">
  <div class="container mx-auto flex justify-between items-center py-4 px-6">
    <a href="/" class="flex items-center space-x-3">
      <img src="/st-georg-kita-ritter-babydrache.png" alt="Kita Großweil" class="h-14 w-auto" />
    </a>

    <!-- Desktop Navigation -->
    <nav class="hidden xl:flex space-x-6">
      <ul class="xl:flex space-x-6">
        {navItems.map(item => (
          <li class="relative group content-center">
            <a
              href={item.href || "#"}
              class={`nav-link ${item.isButton ? 'btn btn-primary' : ''}`}
            >
              {item.title}
            </a>
            {item.children && (
              <ul class="absolute left-0 mt-2 w-60 bg-brand-surface rounded-lg shadow-lg opacity-0 invisible group-hover:opacity-100 group-hover:visible transition-all duration-300 z-50">
                {item.children.map(child => (
                  <li>
                    <a href={child.href} class="block px-4 py-2 text-brand-secondary hover:bg-brand-primary rounded-lg transition-colors">
                      {child.title}
                    </a>
                  </li>
                ))}
              </ul>
            )}
          </li>
        ))}
      </ul>
    </nav>

    <!-- Hamburger Button Mobile -->
    <button id="menu-btn" class="xl:hidden relative h-8 w-8 text-brand-secondary" aria-controls="mobile-menu" aria-expanded="false">
      <svg id="burger-icon" xmlns="http://www.w3.org/2000/svg" class="h-full w-full absolute top-0 left-0 transition-opacity duration-300 opacity-100" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
        <path stroke-linecap="round" stroke-linejoin="round" d="M4 6h16M4 12h16M4 18h16" />
      </svg>
      <svg id="close-icon" xmlns="http://www.w3.org/2000/svg" class="h-full w-full absolute top-0 left-0 transition-opacity duration-300 opacity-0" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
        <path stroke-linecap="round" stroke-linejoin="round" d="M6 18L18 6M6 6l12 12" />
      </svg>
    </button>
  </div>
</header>

<!-- Mobile Drawer -->
<nav id="mobile-menu" class="fixed top-0 left-0 h-full w-64 bg-brand-surface shadow-lg transform -translate-x-full transition-transform duration-300 xl:hidden z-50 p-6 overflow-y-auto">
  <ul class="space-y-4 text-xl text-brand-secondary">
    {navItems.map((item, i) => (
      <li>
        {item.children ? (
          <>
            <button
              class="flex justify-between w-full items-center px-2 py-2 border border-transparent text-brand-secondary hover:border-brand-secondary hover:bg-brand-hoverSurface rounded-md transition-colors"
              data-toggle={`submenu-${i}`}
              aria-expanded="false"
            >
              {item.title}
              <span class="ml-2">▾</span>
            </button>
            <ul id={`submenu-${i}`} class="ml-4 mt-2 hidden flex-col space-y-2">
                <li><a
            href={item.href}
            class={`block px-2 py-2 border border-transparent text-brand-secondary transition-colors ${
              item.isButton
                ? 'px-6 py-2 font-semibold duration-300 bg-brand-primary hover:text-brand-surface hover:bg-brand-secondary hover:border-brand-secondary rounded-full text-center'
                : 'rounded-md hover:border-brand-secondary hover:bg-brand-hoverSurface'
            } `}
          >
            {item.title} – Übersicht
          </a></li>
              {item.children.map(child => (
                <li>
                  <a href={child.href} class="block px-2 py-1 border border-transparent text-brand-secondary hover:border-brand-secondary hover:bg-brand-hoverSurface rounded-md transition-colors">
                    {child.title}
                  </a>
                </li>
              ))}
            </ul>
          </>
        ) : (
          <a
            href={item.href}
            class={`block px-2 py-2 border border-transparent text-brand-secondary transition-colors ${
              item.isButton
                ? 'px-6 py-2 font-semibold duration-300 bg-brand-primary hover:text-brand-surface hover:bg-brand-secondary hover:border-brand-secondary rounded-full text-center'
                : 'rounded-md hover:border-brand-secondary hover:bg-brand-hoverSurface'
            } `}
          >
            {item.title}
          </a>
        )}
      </li>
    ))}
  </ul>
</nav>
<div id="drawer-backdrop" class="fixed inset-0 bg-black bg-opacity-50 hidden z-40 transition-opacity duration-300"></div>


<script type="module">
document.addEventListener('DOMContentLoaded', () => {
  const toggleButton = document.getElementById('menu-btn');
  const mobileMenu = document.getElementById('mobile-menu');
  const burgerIcon = document.getElementById('burger-icon');
  const closeIcon = document.getElementById('close-icon');
  const backdrop = document.getElementById('drawer-backdrop');

// Öffnen / Schließen mit Scroll-Lock
const toggleDrawer = (isOpening) => {
   toggleButton.setAttribute('aria-expanded', isOpening.toString());
   mobileMenu.classList.toggle('-translate-x-full', !isOpening);
   mobileMenu.classList.toggle('translate-x-0', isOpening);
   backdrop.classList.toggle('hidden', !isOpening);

   burgerIcon.style.opacity = isOpening ? '0' : '1';
   closeIcon.style.opacity = isOpening ? '1' : '0';

   // Body Scroll sperren oder freigeben
   document.body.classList.toggle('overflow-hidden', isOpening);
 };

 toggleButton.addEventListener('click', () => {
   const expanded = toggleButton.getAttribute('aria-expanded') === 'true';
   toggleDrawer(!expanded);
 });

 backdrop.addEventListener('click', () => toggleDrawer(false));


  // Mobile Untermenüs
  document.querySelectorAll('#mobile-menu button[data-toggle]').forEach(btn => {
    const targetId = btn.dataset.toggle;
    const submenu = document.getElementById(targetId);

    btn.addEventListener('click', () => {
      const expanded = btn.getAttribute('aria-expanded') === 'true';
      btn.setAttribute('aria-expanded', (!expanded).toString());
      submenu.classList.toggle('hidden');
    });
  });
});

</script>